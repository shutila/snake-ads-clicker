<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Калькулятор</title>
    <style>
        /* Basic reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font: bold 14px Arial, sans-serif;
        }

        /* A nice BG gradient */
        html {
            height: 100%;
            background: white;
            background: radial-gradient(circle, #fff 20%, #ccc);
            background-size: cover;
        }

        /* Using box shadows to create 3D effects */
        #calculator {
            width: 325px;
            height: auto;
            margin: 100px auto;
            padding: 20px 20px 9px;
            background: #9dd2ea;
            background: linear-gradient(#9dd2ea, #8bceec);
            border-radius: 3px;
            box-shadow: 0px 4px #009de4, 0px 10px 15px rgba(0, 0, 0, 0.2);
        }

        /* Screen and keys styling */
        .top span.clear {
            float: left;
        }

        .top .screen {
            height: 40px;
            width: 212px;
            float: right;
            padding: 0 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            box-shadow: inset 0px 4px rgba(0, 0, 0, 0.2);
            font-size: 17px;
            line-height: 40px;
            color: white;
            text-align: right;
            letter-spacing: 1px;
        }

        .keys, .top {overflow: hidden;}

        .keys span, .top span.clear {
            float: left;
            position: relative;
            top: 0;
            cursor: pointer;
            width: 66px;
            height: 36px;
            background: white;
            border-radius: 3px;
            box-shadow: 0px 4px rgba(0, 0, 0, 0.2);
            margin: 0 7px 11px 0;
            color: #888;
            line-height: 36px;
            text-align: center;
            user-select: none;
            transition: all 0.2s ease;
        }

        .keys span.operator {
            background: #FFF0F5;
            margin-right: 0;
        }

        .keys span.eval {
            background: #f1ff92;
            box-shadow: 0px 4px #9da853;
            color: #888e5f;
        }

        .keys span:hover {
            background: #9c89f6;
            box-shadow: 0px 4px #6b54d3;
            color: white;
        }

        .keys span.eval:hover {
            background: #abb850;
            box-shadow: 0px 4px #717a33;
            color: #ffffff;
        }

        .top span.clear:hover {
            background: #f68991;
            box-shadow: 0px 4px #d3545d;
            color: white;
        }

        .keys span:active {
            box-shadow: 0px 0px #6b54d3;
            top: 4px;
        }

        .keys span.eval:active {
            box-shadow: 0px 0px #717a33;
            top: 4px;
        }

        .top span.clear:active {
            top: 4px;
            box-shadow: 0px 0px #d3545d;
        }
    </style>
</head>
<body>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>      
    <div id="calculator">
        <!-- Screen and clear key -->
        <div class="top">
            <span class="clear">C</span>
            <div class="screen"></div>
        </div>
        <div class="keys">
            <!-- operators and other keys -->
            <span>7</span>
            <span>8</span>
            <span>9</span>
            <span class="operator">+</span>
            <span>4</span>
            <span>5</span>
            <span>6</span>
            <span class="operator">-</span>
            <span>1</span>
            <span>2</span>
            <span>3</span>
            <span class="operator">÷</span>
            <span>0</span>
            <span>.</span>
            <span class="eval">=</span>
            <span class="operator">x</span>
        </div>
    </div>
    
    <script>
        // Get all the keys from document
        var keys = document.querySelectorAll('#calculator span');
        var operators = ['+', '-', 'x', '÷'];
        var decimalAdded = false;

        // Add onclick event to all the keys and perform operations
        for (var i = 0; i < keys.length; i++) {
            keys[i].onclick = function(e) {
                var input = document.querySelector('.screen');
                var inputVal = input.textContent;
                var btnVal = this.textContent;

                // Clear the input if 'C' is pressed
                if (btnVal == 'C') {
                    input.textContent = '';
                    decimalAdded = false;
                }
                // Evaluate the expression if '=' is pressed
                else if (btnVal == '=') {
                    var equation = inputVal;
                    var lastChar = equation[equation.length - 1];

                    // Replace x and ÷ with * and /
                    equation = equation.replace(/x/g, '*').replace(/÷/g, '/');

                    // Remove last operator/decimal if exists
                    if (operators.indexOf(lastChar) > -1 || lastChar == '.')
                        equation = equation.slice(0, -1);

                    if (equation) {
                        try {
                            input.textContent = eval(equation);
                        } catch (e) {
                            input.textContent = 'Error';
                        }

                        // Show ad using VK Bridge
                        bridge.send('VKWebAppShowNativeAds', { ad_format: 'reward' })
                        .then((data) => {
                            if (data.result) console.log('Реклама показана');
                            else console.log('Ошибка при показе рекламы');
                        })
                        .catch((error) => {
                            console.log('Ошибка:', error);
                        });
                    }
                    decimalAdded = false;
                }
                // Handle operators
                else if (operators.indexOf(btnVal) > -1) {
                    var lastChar = inputVal[inputVal.length - 1];
                    if (inputVal != '' && operators.indexOf(lastChar) == -1)
                        input.textContent += btnVal;
                    else if (inputVal == '' && btnVal == '-') 
                        input.textContent += btnVal;
                    if (operators.indexOf(lastChar) > -1 && inputVal.length > 1)
                        input.textContent = inputVal.slice(0, -1) + btnVal;
                    decimalAdded = false;
                }
                // Handle decimal
                else if (btnVal == '.') {
                    if (!decimalAdded) {
                        input.textContent += btnVal;
                        decimalAdded = true;
                    }
                }
                // Append numbers
                else {
                    input.textContent += btnVal;
                }
                e.preventDefault();
            } 
        }
    </script>
</body>
</html>
