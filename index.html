<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор</title>
    <style>
        /* Основной сброс стилей */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font: bold 14px Arial, sans-serif;
        }

        /* Задний фон */
        html {
            height: 100%;
            background: radial-gradient(circle, #fff 20%, #ccc);
            background-size: cover;
        }

        /* Стили калькулятора */
        #calculator {
            width: 325px;
            margin: 100px auto;
            padding: 20px 20px 9px;
            background: linear-gradient(#9dd2ea, #8bceec);
            border-radius: 3px;
            box-shadow: 0px 4px #009de4, 0px 10px 15px rgba(0, 0, 0, 0.2);
        }

        /* Стили для верхней части (экран и кнопка очистки) */
        .top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top .clear {
            background: #ff9fa8;
            box-shadow: 0px 4px #ff7c87;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }

        .top .clear:hover {
            background: #f68991;
        }

        .screen {
            height: 40px;
            width: 212px;
            padding: 0 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            box-shadow: inset 0px 4px rgba(0, 0, 0, 0.2);
            font-size: 17px;
            line-height: 40px;
            color: white;
            text-align: right;
        }

        /* Стили для кнопок */
        .keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 10px;
            margin-top: 20px;
        }

        .keys span {
            background: white;
            border-radius: 3px;
            box-shadow: 0px 4px rgba(0, 0, 0, 0.2);
            color: #888;
            text-align: center;
            line-height: 36px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .keys span:hover {
            background: #9c89f6;
            box-shadow: 0px 4px #6b54d3;
            color: white;
        }

        .keys span.eval {
            background: #f1ff92;
            box-shadow: 0px 4px #9da853;
            color: #888e5f;
        }

        .keys span.eval:hover {
            background: #abb850;
            box-shadow: 0px 4px #717a33;
            color: white;
        }

        .keys span.operator {
            background: #FFF0F5;
        }

        .keys span.operator:hover {
            background: #9c89f6;
            color: white;
        }
    </style>

    <!-- Подключаем VK Bridge -->
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
    <!-- Калькулятор -->
    <div id="calculator">
        <!-- Верхняя часть: кнопка очистки и экран -->
        <div class="top">
            <span class="clear">C</span>
            <div class="screen"></div>
        </div>

        <!-- Кнопки калькулятора -->
        <div class="keys">
            <span>7</span>
            <span>8</span>
            <span>9</span>
            <span class="operator">+</span>
            <span>4</span>
            <span>5</span>
            <span>6</span>
            <span class="operator">-</span>
            <span>1</span>
            <span>2</span>
            <span>3</span>
            <span class="operator">÷</span>
            <span>0</span>
            <span>.</span>
            <span class="eval">=</span>
            <span class="operator">x</span>
        </div>
    </div>

    <script>
        // Инициализация VK Bridge
        vkBridge.send("VKWebAppInit")
            .then(() => {
                console.log('VK Bridge успешно инициализирован');
            })
            .catch((error) => {
                console.log('Ошибка инициализации VK Bridge:', error);
            });

        // Переменные для работы с калькулятором
        var keys = document.querySelectorAll('#calculator span');
        var operators = ['+', '-', 'x', '÷'];
        var decimalAdded = false;

        // Добавляем обработчик на все клавиши
        for (var i = 0; i < keys.length; i++) {
            keys[i].onclick = function (e) {
                var input = document.querySelector('.screen');
                var inputVal = input.innerHTML;
                var btnVal = this.innerHTML;

                if (btnVal == 'C') {
                    input.innerHTML = '';
                    decimalAdded = false;
                } else if (btnVal == '=') {
                    var equation = inputVal;
                    var lastChar = equation[equation.length - 1];

                    // Показываем рекламу перед вычислением
                    showAd();

                    equation = equation.replace(/x/g, '*').replace(/÷/g, '/');
                    if (operators.indexOf(lastChar) > -1 || lastChar == '.') {
                        equation = equation.replace(/.$/, '');
                    }

                    if (equation) {
                        input.innerHTML = eval(equation);
                    }

                    decimalAdded = false;
                } else if (operators.indexOf(btnVal) > -1) {
                    var lastChar = inputVal[inputVal.length - 1];
                    if (inputVal != '' && operators.indexOf(lastChar) == -1) {
                        input.innerHTML += btnVal;
                    } else if (inputVal == '' && btnVal == '-') {
                        input.innerHTML += btnVal;
                    }
                    if (operators.indexOf(lastChar) > -1 && inputVal.length > 1) {
                        input.innerHTML = inputVal.replace(/.$/, btnVal);
                    }
                    decimalAdded = false;
                } else if (btnVal == '.') {
                    if (!decimalAdded) {
                        input.innerHTML += btnVal;
                        decimalAdded = true;
                    }
                } else {
                    input.innerHTML += btnVal;
                }

                e.preventDefault();
            }
        }

        // Функция показа рекламы
        function showAd() {
            console.log("Запрос на показ рекламы отправлен.");
            vkBridge.send('VKWebAppShowNativeAds', { ad_format: 'reward' })
                .then((data) => {
                    if (data.result) {
                        console.log('Реклама показана');
                    } else {
                        console.log('Ошибка при показе рекламы');
                    }
                })
                .catch((error) => {
                    console.log('Ошибка при показе рекламы:', error);
                });
        }
    </script>
</body>
</html>
